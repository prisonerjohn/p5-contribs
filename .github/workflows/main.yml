name: Generate JSON

on: 
  push:
    branches:
      - main
      - master
  schedule:
    # * is a special character in YAML so you have to quote this string
    - cron:  '45 3 * * *'

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - name: Set up Python 3.x
        uses: actions/setup-python@v2
        with:
          # Semantic version range syntax or exact version of a Python version
          python-version: '3.x'
          # Optional - x64 or x86 architecture, defaults to x64
          architecture: 'x64'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
      - name: Display Python version
        run: python -c "import sys; print(sys.version)"
      - name: Build contributions file with default params
        run: |
          cd scripts
          python build_contribs.py
      - name: Check if there are changes
        id: changes
        uses: UnicornGlobal/has-changes-action@v1.0.11
      - name: Process changes
        if: steps.changes.outputs.changed == 1
        run: |
          git config --global user.name 'P5 Robot'
          git config --global user.email 'p5-bot@users.noreply.github.com'
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git commit -am "Update contributions [skip ci]"
          git push
